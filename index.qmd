---
title: "Starry Night?"
subtitle: An exploration of nighttime lights and the Dark-Sky Movement in the US
author: Carly Staebell
date: today
date-format: long
---

# Introduction

Electric lights have benefited society immensely since their invention in 1879. Modern work, recreation, and transportation are made possible largely due to artificial lighting. However, when artificial outdoor lighting becomes inefficient and unnecessary, it is known as light pollution, with negative impacts on both wildlife and humans (Chepesiuk 2009). 

Concerns about the effects of light pollution on astronomy led to the 1988 formation of the nonprofit now known as DarkSky International (Hunter 2023). Since then, DarkSky has grown into a recognized global authority on light pollution with a mission to safeguard communities and wildlife against light pollution (DarkSky 2025a). The organization's International Dark Sky Places program allows communities, parks, and protected areas to seek certification for efforts to preserve and protect their dark skies (DarkSky 2025b). 

Notably, Flagstaff, Arizona was the first International Dark Sky Place, designated in 2001. As a hub for astronomical observation, the city has been a leader in outdoor lighting policy since 1958 (Darksky 2015). Other cities, particularly those in the western US, have also recognized the need for measures to combat light pollution, and have achieved DarkSky certification. While certification is certainly not necessary for communities to implement outdoor lighting ordinances and other measures to curb light pollution, it is an indicator of places that have made dark sky conservation a priority. 

This project aims to explore trends in nighttime light levels first from a national contiguous US perspective, and through more detailed case studies of individual cities. 

# Materials and methods

Three Dark Sky Certified communities with different sizes and designation dates have been selected: 

* Flagstaff, Arizona: Population ~77,000, designated 2001;
* Homer Glen, Illinois: Population ~25,000, designated 2011;
* Bee Cave, Texas: Population ~9,000, designated 2023.

These three communities will each be paired with a community of similar size that has fewer, if any, ordinances controlling light pollution. Each community pair will be examined to see if there are observable differences in nighttime light emissions.

Data are sourced from NASA's Black Marble annual nighttime lights product and the US Census.



Load any required packages in a code chunk:

```{r load packages, message=F, warning=F}
library(tidyverse)
library(leaflet)
library(kableExtra)
library(htmlwidgets)
library(widgetframe)
knitr::opts_chunk$set(widgetframe_widgets_dir = 'widgets' ) 
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling

library(blackmarbler)
library(sf)
library(terra)
library(tigris)
library(tidyterra)
library(tidycensus)
library(patchwork)
```


```{r keys, echo = F}
# to be handled better later
nasa_bearer_token <- "eyJ0eXAiOiJKV1QiLCJvcmlnaW4iOiJFYXJ0aGRhdGEgTG9naW4iLCJzaWciOiJlZGxqd3RwdWJrZXlfb3BzIiwiYWxnIjoiUlMyNTYifQ.eyJ0eXBlIjoiVXNlciIsInVpZCI6ImNzdGFlYmVsbDgiLCJleHAiOjE3NjUxNTUwOTEsImlhdCI6MTc1OTk3MTA5MSwiaXNzIjoiaHR0cHM6Ly91cnMuZWFydGhkYXRhLm5hc2EuZ292IiwiaWRlbnRpdHlfcHJvdmlkZXIiOiJlZGxfb3BzIiwiYWNyIjoiZWRsIiwiYXNzdXJhbmNlX2xldmVsIjozfQ.IQr7UctiPuMVhucTMMTuP2tsBUgoz0P5Arr7u2JnBUKDhLnwjM3ZB6ozNoKK2k0coLKBTbniUV7OTAmzrG3Z1yOCrRdJlpNy9Qt1T-nZQKlJ5BfYvgC_1QkS6R4QNux3OsBibSK0-Rc8rlk3SJqbQl_h-d6iIMSr2vo02ynrNNFtElmV3c9NUGgA0ffaoqYJgDu9GSxH6yevTQ_bXKDtouhz4U52gbybt61_1VOsKNPzj71dkWuXAepMwT5S2AXZLzllKcrt9By_SjSY6UwfZwFzAlsjBNnOf8U0ZfR_9UJ44oxaeeoYE-MJsJQKNUS2vhStDm64zNTMhul0xbnMoA"

census_api_key <- "ea81e8f86d73c0f7568c2703d4f50df48872b05a"
```


## Download and clean all required data

The nighttime lights raster and extracted values for the entire US take a while to download, so I had planned to include the following code which writes the data to files that can be loaded individually. But the files are somewhat large and I broke my original github build when I committed the update containing them. (Maybe there was another issue causing the build failure but the files are larger than recommended for storage in the data folder, anyway.)

```{r US Black Marble Data, eval = F}
# Download and save CONUS black marble data. 

# Define region of interest
nonconus <- c("Guam", "Hawaii", "Alaska",
              "Commonwealth of the Northern Mariana Islands",
              "United States Virgin Islands", "American Samoa", "Puerto Rico")
states_sf <- states() |>
  filter(!NAME %in% nonconus) |>
  select(NAME, geometry) |>
  st_transform(crs = "epsg:4326") # EPSG:4326 for compatibility with black marble

# Nighttime lights annual data (black marble)
bm_annual <- bm_raster(roi_sf = states_sf,
                      product_id = "VNP46A4",
                      date = c(2012,2024),
                      bearer = nasa_bearer_token) |> terra::mask(states_sf)

writeRaster(bm_annual, filename = "data/blackmarble_us_2012_2024.tif")

# Create log transformed version for mapping
app(bm_annual, fun = log1p, filename = "data/log_blackmarble_us_2012_2024.tif", overwrite = TRUE)

# values
ntl_2012_2024 <- bm_extract(roi_sf = states_sf,
                         product_id = "VNP46A4",
                         date = 2012:2024, 
                         bearer = nasa_bearer_token)

write.csv(ntl_2012_2024, "data/bm_vals_states_2012to2024.csv", row.names = FALSE)
```


```{r download census data, warning = F, message = F, output = F}

# Download population data
us_pop <- get_acs(geograph = "place", state = NULL, 
                  variables = "B01003_001", key = census_api_key)

az_pop <- get_acs(geography = "place", state = "AZ", 
                         variables = "B01003_001", key = census_api_key)

il_pop <- get_acs(geography = "place", state = "IL", 
                         variables = "B01003_001", key = census_api_key)

tx_pop <- get_acs(geography = "place", state = "TX", 
                         variables = "B01003_001", key = census_api_key)

# Download local geographies: selected Dark Sky Places
flagstaff <- places(state = "AZ", cb = TRUE, year = 2024) |>
  filter(NAME == "Flagstaff") |>
  st_transform(crs = "epsg:4326") |>
  left_join(us_pop, by = "GEOID")

homerglen <- places(state = "IL", cb = TRUE, year = 2024) |>
  filter(NAME == "Homer Glen") |>
  st_transform(crs = "epsg:4326") |>
  left_join(us_pop, by = "GEOID")

beecave <- places(state = "TX", cb = TRUE, year = 2024) |>
  filter(NAME == "Bee Cave") |>
  st_transform(crs = "epsg:4326") |>
  left_join(us_pop, by = "GEOID")

```

```{r process census data, message = F, output = F}

# Find suitable comparison cities
flagstaff_sim_pop <- us_pop |> filter(estimate >= (flagstaff$estimate - 0.01*flagstaff$estimate) 
                                & estimate <= (flagstaff$estimate + 0.01*flagstaff$estimate)) |>
  separate(NAME, into = c("city", "state"), sep = ", ")

homerglen_sim_pop <- us_pop |> filter(estimate >= (homerglen$estimate - 0.005*homerglen$estimate) 
                                & estimate <= (homerglen$estimate + 0.005*homerglen$estimate)) |>
  separate(NAME, into = c("city", "state"), sep = ", ")

beecave_sim_pop <- us_pop |> filter(estimate >= (beecave$estimate - 0.005*beecave$estimate) 
                                & estimate <= (beecave$estimate + 0.005*beecave$estimate)) |>
  separate(NAME, into = c("city", "state"), sep = ", ")

# Download/process comparison city data
 # Flagstaff counterpart
scranton <- places(state = "PA", cb = TRUE, year = 2024) |>
  filter(NAME == "Scranton") |>
  left_join(us_pop, by = "GEOID") |>
  st_transform(crs = "epsg:4326")

 # Homer Glen counterpart
belvidere <- places(state = "IL", cb = TRUE, year = 2024) |>
  filter(NAME == "Belvidere") |>
  left_join(us_pop, by = "GEOID") |>
  st_transform(crs = "epsg:4326")

 # Bee Cave counterpart
clanton <- places(state = "AL", cb = TRUE, year = 2024) |>
  filter(NAME == "Clanton") |>
  left_join(us_pop, by = "GEOID") |>
  st_transform(crs = "epsg:4326")

```

Add any additional processing steps here.

# Results



### Dygraphs Example

```{r}
library(dygraphs)
dygraph(nhtemp, main = "New Haven Temperatures") |> 
  dyRangeSelector(dateWindow = c("1920-01-01", "1960-01-01")) 
```

# Conclusions



# References

Bocinsky, R.K., Beaudette, D., Chamberlain, S., Hollister, J., Gustavsen, J. (2025). Package 'FedData'. <https://cran.r-project.org/web/packages/FedData/FedData.pdf>.

Chepesiuk, R. (2009). Missing the dark: health effects of light pollution. Environmental Health Perspectives, 117(1), A20+. <https://www.jstor.org/stable/40066663>.

DarkSky International. (2015). Flagstaff, Arizona. <https://darksky.org/places/flagstaff-arizona-dark-sky-community/>.

DarkSky International. (2025a). About DarkSky. <https://darksky.org/about/#mission>.

DarkSky International (2025b). International Dark Sky Places. <https://darksky.org/what-we-do/international-dark-sky-places/>.

Hunter, T., (2023). The birth of DarkSky (IDA) and a lifelong mission fighting light pollution. DarkSky. <https://darksky.org/news/the-birth-of-ida-and-a-lifelong-mission-fighting-light-pollution/>.

Marty, R., Vicente, G.S. (2025). Package 'blackmarbler'. <https://cran.r-project.org/web/packages/blackmarbler/blackmarbler.pdf>.

NASA. Black Marble. <https://blackmarble.gsfc.nasa.gov/>.

Schultz, J. (2022). States shut out light pollution. National Conference of State Legislatures. <https://www.ncsl.org/environment-and-natural-resources/states-shut-out-light-pollution>

Stare, J., Kyba, C. (2025): Radiance Light Trends. GFZ Data Services. <https://doi.org/10.5880/GFZ.1.4.2019.001>.

Walker, K., Herman, M. (2025). tidycensus: Load US Census Boundary and Attribute Data as 'tidyverse' and 'sf'-Ready Data Frames. R package version 1.7.3, <https://walker-data.com/tidycensus/>.

Weishampel, Z.A., Cheng, W.-H. and Weishampel, J.F. (2016), Sea turtle nesting patterns in Florida vis-Ã -vis satellite-derived measures of artificial lighting. Remote Sens Ecol Conserv, 2: 59-72. <https://doi.org/10.1002/rse2.12>.
