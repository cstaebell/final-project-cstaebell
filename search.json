[
  {
    "objectID": "data/Readme.html",
    "href": "data/Readme.html",
    "title": "Data Folder",
    "section": "",
    "text": "Data Folder\nPlace any data needed by your analysis in this folder. Please do not store large files here. Then read in any data using the ‘data’ path. For example, read_csv(\"data/data.csv\")."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Starry Night?",
    "section": "",
    "text": "Electric lights have benefited society immensely since their invention in 1879. Modern work, recreation, and transportation are made possible largely due to artificial lighting. However, when artificial outdoor lighting becomes inefficient and unnecessary, it is known as light pollution, with negative impacts on both wildlife and humans [1].\nConcerns about the impacts of light pollution on astronomical observation led to the 1988 formation of the nonprofit now known as DarkSky International [2]. Since then, DarkSky has grown into a recognized global authority on light pollution with a mission to safeguard communities and wildlife against light pollution [3]. The organization’s International Dark Sky Places program allows communities, parks, and protected areas to seek certification for efforts to preserve and protect their dark skies [4]. While many communities implement outdoor lighting policies without seeking recognition, a DarkSky certification is an indicator of places that have made dark sky conservation a priority.\nThis project aims to explore trends in nighttime light levels first from a national contiguous US perspective, and through more detailed case studies of individual cities. Three DarkSky certified communities [4] with different sizes and designation dates have been selected:\n\nFlagstaff, Arizona: Population ~77,000, designated 2001;\nHomer Glen, Illinois: Population ~25,000, designated 2011;\nBee Cave, Texas: Population ~9,000, designated 2023.\n\nThese three communities were each paired with a community of similar size that has fewer, if any, ordinances controlling light pollution. Each community pair was examined to see if there are observable differences in nighttime radiance."
  },
  {
    "objectID": "index.html#download-and-clean-all-required-data",
    "href": "index.html#download-and-clean-all-required-data",
    "title": "Starry Night?",
    "section": "Download and clean all required data",
    "text": "Download and clean all required data\n\nNational and statewide nighttime lights\nA US Census TIGER shapefile was downloaded to provide geographic state boundaries. A separate script was used to download and save annual nighttime lights rasters for the contiguous US (‘black_marble_data_download.R’). The script was also used to obtain extracted nighttime lights values aggregated at the national and state levels. Nighttime lights are provided as radiance values with units of \\(\\frac{n W}{cm^2 sr}\\).\n\n\nCode\n# Download and process CONUS NTL data\n# Define national spatial extent\nnonconus &lt;- c(\"Guam\", \"Hawaii\", \"Alaska\",\n              \"Commonwealth of the Northern Mariana Islands\",\n              \"United States Virgin Islands\", \"American Samoa\", \"Puerto Rico\")\n\nstates_sf &lt;- states() |&gt;\n  filter(!NAME %in% nonconus) |&gt;\n  select(NAME, geometry) |&gt;\n  st_transform(crs = \"epsg:4326\")\n\n# Dissolve individual state boundaries to get CONUS outline\nconus &lt;- st_union(states_sf)|&gt;\n  st_as_sf()\n\n## Read in national raster data for 2024 (to be used for leaflet map later)\npb_download(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_t2024.tif\", \n            repo = \"cstaebell/final-project-cstaebell\")\n\nus_2024_rast &lt;- rast(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_t2024.tif\") |&gt;\n  mask(conus)\n\n# create log transformed version for plotting\nlog_us_2024 &lt;- app(us_2024_rast, fun = log1p)\n\n# Downsample log data for map (commented out since file written)\n#aggregate(log_us_2024, fact = 4, fun = \"median\", filename = \"data/log_us_2024_downsampled.tif\", overwrite = TRUE)\n\n#---\n# Download and process annual US mean NTL values\n#---\nyears = 2014:2024\nconus_means = numeric(length(years))\n\nfor (i in 1:length(years)) {\n  pb_download(paste(\"CONUS_VNP46A4_NearNadir_Composite_Snow_Free_qflag_mean_t\",\n                             years[i], \".Rds\", sep = \"\"), repo = \"cstaebell/final-project-cstaebell\")\n  annual_mean &lt;- readRDS(paste(\"CONUS_VNP46A4_NearNadir_Composite_Snow_Free_qflag_mean_t\",\n                             years[i], \".Rds\", sep = \"\")) |&gt;\n    pull(ntl_mean)\n  \n  conus_means[i] &lt;- annual_mean\n}\n\nconus_df &lt;- data.frame(year = years, mean_ntl = conus_means)\n\n#---\n# Download and process mean NTL values for states\n#---\nstate_means &lt;- matrix(nrow = 49, ncol = length(years))\n\n# Read in annual data for states and create a matrix of state means\nfor (i in 1:length(years)) {\n  pb_download(paste(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_mean_t\",\n                             years[i], \".Rds\", sep = \"\"), repo = \"cstaebell/final-project-cstaebell\")\n  annual_mean &lt;- readRDS(paste(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_mean_t\",\n                             years[i], \".Rds\", sep = \"\"))\n  \n  state_means[,i] &lt;- annual_mean[,2]\n\n  # check that state names are ordered the same way for each year\n  if (i == 1) {\n    state_names &lt;- annual_mean[,1]\n  } else {\n    if (sum(state_names != annual_mean[,1]) != 0) {\n      print(\"Different state names\")\n    }\n  }\n}\n\n# Create data frame of state means and add percent change column\nstate_means_df &lt;- data.frame(state_means)\ncolnames(state_means_df) &lt;- paste(\"ntl_\", years, sep = \"\")\nstate_means_df &lt;- state_means_df |&gt;\n  mutate(state = state_names, \n         pct_change = (ntl_2024 - ntl_2014) / ntl_2014 * 100)\n\n\n# Combine state NTL data with geographic data\nstates_ntl &lt;- states_sf |&gt;\n  inner_join(state_means_df, by = c(\"NAME\" = \"state\"))\n\n\n\n\nCase Studies\nFor case study analyses, population data and local geographies for each Dark Sky Place were downloaded from the US Census.\n\n\nCode\n# Download population data\n# US population to search for comparison cities\nus_pop &lt;- get_acs(geography = \"place\", state = NULL, \n                  variables = \"B01003_001\", key = census_api_key)\n\n# Download local geographies: selected Dark Sky Places\nflagstaff_sf &lt;- places(state = \"AZ\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Flagstaff\") |&gt;\n  st_transform(crs = \"epsg:4326\") |&gt;\n  left_join(us_pop, by = \"GEOID\")\n\nhomerglen_sf &lt;- places(state = \"IL\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Homer Glen\") |&gt;\n  st_transform(crs = \"epsg:4326\") |&gt;\n  left_join(us_pop, by = \"GEOID\")\n\nbeecave_sf &lt;- places(state = \"TX\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Bee Cave\") |&gt;\n  st_transform(crs = \"epsg:4326\") |&gt;\n  left_join(us_pop, by = \"GEOID\")\n\n\nACS population data were filtered to return a listing of candidate municipalities with populations within 1% of each Dark Sky community population. Final Comparison cities were selected based on population match and state, with preference given to cities within states that are not known to have laws regarding outdoor lighting geared toward dark sky protection [12].\n\n\nCode\n# Get listing of suitable comparison cities\nflagstaff_sim_pop &lt;- us_pop |&gt; filter(estimate &gt;= (flagstaff_sf$estimate - 0.005*flagstaff_sf$estimate) \n                                & estimate &lt;= (flagstaff_sf$estimate + 0.005*flagstaff_sf$estimate)) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \")\n\nhomerglen_sim_pop &lt;- us_pop |&gt; filter(estimate &gt;= (homerglen_sf$estimate - 0.005*homerglen_sf$estimate) \n                                & estimate &lt;= (homerglen_sf$estimate + 0.005*homerglen_sf$estimate)) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \")\n\nbeecave_sim_pop &lt;- us_pop |&gt; filter(estimate &gt;= (beecave_sf$estimate - 0.005*beecave_sf$estimate) \n                                & estimate &lt;= (beecave_sf$estimate + 0.005*beecave_sf$estimate)) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \")\n\n# Download/process comparison city data\n # Flagstaff counterpart\nscranton_sf &lt;- places(state = \"PA\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Scranton\") |&gt;\n  left_join(us_pop, by = \"GEOID\") |&gt;\n  st_transform(crs = \"epsg:4326\")\n\n # Homer Glen counterpart\nbelvidere_sf &lt;- places(state = \"IL\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Belvidere\") |&gt;\n  left_join(us_pop, by = \"GEOID\") |&gt;\n  st_transform(crs = \"epsg:4326\")\n\n # Bee Cave counterpart\nclanton_sf &lt;- places(state = \"AL\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Clanton\") |&gt;\n  left_join(us_pop, by = \"GEOID\") |&gt;\n  st_transform(crs = \"epsg:4326\")\n\ncity_names &lt;- c(\"flagstaff\", \"homerglen\", \"beecave\", \"scranton\", \n                           \"belvidere\", \"clanton\")\n\n\nThe final city pairs are as follows:\n\n\n\nPair\nCommunity\nPopulation (2023)\n\n\n\n\nA\nFlagstaff, AZ\n76,333\n\n\nA\nScranton, PA\n76,074\n\n\nB\nHomer Glen, IL\n24,516\n\n\nB\nBelvidere, IL\n24,510\n\n\nC\nBee Cave, TX\n8,861\n\n\nC\nClanton, AL\n8,862\n\n\n\nAnnual population data for each city were downloaded from the ACS. The 5-year ACS was used for years 2014-2023. Since the 1-year ACS is only available for cities with populations &gt; 65,000, 2024 data could only be obtained for Pair A cities. For the remaining cities, 2023 data was used for 2024.\n\n\nCode\n# 2014-2023 uses 5-year ACS population data\nannual_acs &lt;- purrr::map(years[1:10],\n               ~ get_acs(geography = \"place\", \n                         state = c(\"AZ\", \"IL\", \"TX\", \"PA\", \"AL\"),\n                         variables = \"B01003_001\", \n                         key = census_api_key, \n                         year = .x, \n                         survey = \"acs5\")) |&gt;\n  map2(years[1:10], ~ mutate(.x, id = .y)) |&gt;\n  list_rbind() |&gt;\n  filter(GEOID %in% c(flagstaff_sf$GEOID, homerglen_sf$GEOID, beecave_sf$GEOID,\n                      scranton_sf$GEOID, belvidere_sf$GEOID, clanton_sf$GEOID)) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \") |&gt;\n  rename(year = id, pop_est = estimate) |&gt;\n  mutate(city = case_when(\n    city == \"Flagstaff city\" ~ \"flagstaff\",\n    city == \"Scranton city\" ~ \"scranton\",\n    city == \"Homer Glen village\" ~ \"homerglen\",\n    city == \"Belvidere city\" ~ \"belvidere\",\n    city == \"Bee Cave city\" ~ \"beecave\",\n    city == \"Clanton city\" ~ \"clanton\",\n  ))\n\n# 2024 requires 1-year ACS: only available for geographies with populations of 65000 and greater\npop_2024 &lt;- get_acs(geography = \"place\", state = c(\"AZ\", \"PA\"),\n                                variables = \"B01003_001\", key = census_api_key, \n                                year = 2024, survey = \"acs1\")\n\nflagstaff_2024 &lt;- pop_2024 |&gt;\n  filter(GEOID == flagstaff_sf$GEOID) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \") |&gt;\n  rename(pop_est = estimate) |&gt;\n  mutate(year = 2024, city = \"flagstaff\")\n\nscranton_2024 &lt;- pop_2024 |&gt;\n  filter(GEOID == scranton_sf$GEOID) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \") |&gt;\n  rename(pop_est = estimate) |&gt;\n  mutate(year = 2024, city = \"scranton\")\n\n# Since data unavailable for smaller cities for 2024, impute 2023 data\nother_cities_2024 &lt;- annual_acs |&gt;\n  filter(year == 2023 & city != \"flagstaff\" & city != \"scranton\") |&gt;\n  mutate(year = 2024)\n\nall_annual_acs &lt;- annual_acs |&gt;\n  rbind(flagstaff_2024, scranton_2024, other_cities_2024)\n\n\nAfter selecting cities, the annual US nighttime lights rasters were read in and subsetted to create a raster and dataframe of mean values for each city. Since simply looking at annual means for each city may be more of a proxy for overall development than for lighting policy, land use/land cover data1 were also brought in to help make comparisons across communities more meaningful. The land cover rasters were cropped to each city, and then the urban areas were isolated, allowing for calculation of annual mean nighttime lights from urban areas only.\n\n\nCode\n# Nighttime lights and land cover data are in a single chunk to avoid external pointer errors when rendering\n\n#---\n# Nighttime lights\n#---\n# Subset nighttime lights rasters to each city\ncity_sf_list &lt;- list(flagstaff_sf, homerglen_sf, beecave_sf, \n                     scranton_sf, belvidere_sf, clanton_sf)\ncity_ntl_rasters &lt;- vector(\"list\", length = length(city_names))\n\n# Load files for each year\nfor (i in 1:length(years)){\n  pb_download(paste(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_t\", \n                     years[i], \".tif\", sep = \"\"), repo = \"cstaebell/final-project-cstaebell\")\n  rast_file &lt;- paste(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_t\", \n                     years[i], \".tif\", sep = \"\")\n  \n  year_rast &lt;- rast(rast_file)\n  \n  # Loop over cities\n  for (j in 1:length(city_sf_list)) {\n    # Crop and mask to city extent\n    current_rast &lt;- year_rast |&gt;\n      terra::crop(city_sf_list[[j]]) |&gt;\n      mask(city_sf_list[[j]])\n    \n    # Create list entry during first iteration, then append in subsequent iterations\n    if (i == 1) {\n    city_ntl_rasters[[j]] &lt;- list(current_rast)\n    } else {\n    city_ntl_rasters[[j]][[length(city_ntl_rasters[[j]]) + 1]] &lt;- current_rast\n    }\n  }\n}\n\n# Stack city lists \ncity_ntl_rasters &lt;- lapply(city_ntl_rasters, rast)\n\n# Create separate rasters for each city \n#city_ntl_var_names &lt;- paste0(city_names, \"_ntl_rast\")\n#for (c in 1:length(city_ntl_var_names)) {\n#  assign(city_ntl_var_names[c], city_ntl_rasters[[c]])\n#}\n\n# Calculate annual means\nannual_ntl_means &lt;- vector(\"list\", length = length(city_names))\nfor (i in 1:length(city_ntl_rasters)) {\n  ntl_vals &lt;- data.frame(values(city_ntl_rasters[[i]])) |&gt;\n    summarize(across(t2014:t2024, ~ mean(.x, na.rm = TRUE))) |&gt;\n    pivot_longer(cols = t2014:t2024) |&gt;\n    mutate(name = years, city = city_names[i]) |&gt;\n    rename(year = name, mean_ntl = value)\n  \n  annual_ntl_means[[i]] &lt;- ntl_vals\n}\n\nntl_means_df &lt;- list_rbind(annual_ntl_means) |&gt;\n  left_join(all_annual_acs, by = join_by(city == city, year == year)) |&gt;\n  mutate(percap_mean_ntl = mean_ntl / pop_est)\n\n#---\n# Land cover data\n#---\n# Download land cover data \npb_download(\"MCD12Q1.061_LC_Type1_doy2019001000000_aid0001.tif\", \n            repo = \"cstaebell/final-project-cstaebell\")\npb_download(\"MCD12Q1.061_LC_Type1_doy2020001000000_aid0001.tif\", \n            repo = \"cstaebell/final-project-cstaebell\")\nland_use_rast_2019 &lt;- rast(\"MCD12Q1.061_LC_Type1_doy2019001000000_aid0001.tif\")\nland_use_rast_2020 &lt;- rast(\"MCD12Q1.061_LC_Type1_doy2020001000000_aid0001.tif\")\n\n# Subset land cover rasters to each city\nland_use_rasters &lt;- vector(\"list\", length = length(city_sf_list))\nurban_ntl_dfs &lt;- vector(\"list\", length = length(city_sf_list))\nurban_ntl_vals &lt;- vector(\"list\", length = length(city_sf_list))\ngroup_assign &lt;- c(\"Dark Sky\", \"Dark Sky\", \"Dark Sky\", \"Comparison\", \"Comparison\", \"Comparison\")\npair_assign &lt;- c(\"A\", \"B\", \"C\", \"A\", \"B\", \"C\")\n\n\nfor (i in 1:length(city_names)) {\n  # Specify which data to use (2019 for all cities but Clanton)\n  if (i == 6) {\n    land_use_rast &lt;- land_use_rast_2020\n  } else {\n    land_use_rast &lt;- land_use_rast_2019\n  }\n  \n  # Crop and mask to city extent\n  current_rast &lt;- land_use_rast |&gt;\n    terra::crop(city_sf_list[[i]]) |&gt;\n    mask(city_sf_list[[i]])\n  # Save to list for future use \n  land_use_rasters[[i]] &lt;- current_rast\n  \n  # Mask all but urban land use (land use code = 13)\n  urban_area &lt;- current_rast\n  urban_area[urban_area != 13] &lt;- NA\n  city_urban &lt;- city_ntl_rasters[[i]] |&gt;\n    mask(urban_area) \n  \n  # Calculate mean NTL for urban areas \n  urban_ntl_dfs[[i]] &lt;- data.frame(values(city_urban)) |&gt;\n    summarize(across(t2014:t2024, ~ mean(.x, na.rm = TRUE))) |&gt;\n    pivot_longer(cols = t2014:t2024) |&gt;\n    mutate(name = years, city = city_names[i]) |&gt;\n    rename(year = name, mean_urban_ntl = value) \n  \n  # Compile values for statistical tests\n  urban_ntl_vals[[i]] &lt;- data.frame(values(city_urban)) |&gt;\n    pivot_longer(cols = t2014:t2024) |&gt;\n    filter(!is.na(value)) |&gt;\n    mutate(city = city_names[[i]], group = group_assign[i], pair = pair_assign[i])\n}\n\n# Combine all mean NTL data into single data frame\nall_ntl_means_df &lt;- ntl_means_df |&gt;\n  left_join(list_rbind(urban_ntl_dfs), join_by(year == year, city == city)) |&gt;\n  mutate(mean_percap_urban_ntl = mean_urban_ntl / pop_est, \n         pair = case_when(\n           city == \"flagstaff\" | city == \"scranton\" ~ \"A\",\n           city == \"homerglen\" | city == \"belvidere\" ~ \"B\",\n           city == \"beecave\" | city == \"clanton\" ~ \"C\"),\n         group = case_when(\n           city == \"flagstaff\" | city == \"homerglen\" | city == \"beecave\" ~ \"Dark Sky\",\n           city == \"scranton\" | city == \"belvidere\" | city == \"clanton\" ~ \"Comparison\")\n         )\n\n# Prepare data for sample land cover plots\n# Define land cover encoding\nLand_Cover_Type_1 &lt;- c(\n  \"Water\" = 0, \"Evergreen Needleleaf forest\" = 1, \"Evergreen Broadleaf forest\" = 2,\n  \"Deciduous Needleleaf forest\" = 3, \"Deciduous Broadleaf forest\" = 4, \"Mixed forest\" = 5,\n  \"Closed shrublands\" = 6, \"Open shrublands\" = 7, \"Woody savannas\" = 8, \"Savannas\" = 9,\n  \"Grasslands\" = 10, \"Permanent wetlands\" = 11, \"Croplands\" = 12, \"Urban & built-up\" = 13,\n  \"Cropland/Natural vegetation mosaic\" = 14, \"Snow & ice\" = 15, \"Barren/Sparsely vegetated\" = 16\n)\n\nlcd &lt;- data.frame(\n  ID = Land_Cover_Type_1,\n  landcover = names(Land_Cover_Type_1),\n  stringsAsFactors = FALSE)\n\n# Create data frames for plotting\nflagstaff_lulc &lt;- as.data.frame(land_use_rasters[[1]], xy = TRUE) |&gt;\n  left_join(lcd, by = join_by(MCD12Q1.061_LC_Type1_doy2019001000000_aid0001 == ID)) |&gt;\n  rename(lc_code = MCD12Q1.061_LC_Type1_doy2019001000000_aid0001) |&gt;\n  mutate(city = \"Flagstaff\")\n\nscranton_lulc &lt;- as.data.frame(land_use_rasters[[4]], xy = TRUE) |&gt;\n  left_join(lcd, by = join_by(MCD12Q1.061_LC_Type1_doy2019001000000_aid0001 == ID)) |&gt;\n  rename(lc_code = MCD12Q1.061_LC_Type1_doy2019001000000_aid0001) |&gt;\n  mutate(city = \"Scranton\")\n\nhomerglen_lulc &lt;- as.data.frame(land_use_rasters[[2]], xy = TRUE) |&gt;\n  left_join(lcd, by = join_by(MCD12Q1.061_LC_Type1_doy2019001000000_aid0001 == ID)) |&gt;\n  rename(lc_code = MCD12Q1.061_LC_Type1_doy2019001000000_aid0001) |&gt;\n  mutate(city = \"Homer Glen\")\n\nbelvidere_lulc &lt;- as.data.frame(land_use_rasters[[5]], xy = TRUE) |&gt;\n  left_join(lcd, by = join_by(MCD12Q1.061_LC_Type1_doy2019001000000_aid0001 == ID)) |&gt;\n  rename(lc_code = MCD12Q1.061_LC_Type1_doy2019001000000_aid0001) |&gt;\n  mutate(city = \"Belvidere\")\n\nbeecave_lulc &lt;- as.data.frame(land_use_rasters[[3]], xy = TRUE) |&gt;\n  left_join(lcd, by = join_by(MCD12Q1.061_LC_Type1_doy2019001000000_aid0001 == ID)) |&gt;\n  rename(lc_code = MCD12Q1.061_LC_Type1_doy2019001000000_aid0001) |&gt;\n  mutate(city = \"Bee Cave\")\n\nclanton_lulc &lt;- as.data.frame(land_use_rasters[[6]], xy = TRUE) |&gt;\n  left_join(lcd, by = join_by(MCD12Q1.061_LC_Type1_doy2020001000000_aid0001 == ID)) |&gt;\n  rename(lc_code = MCD12Q1.061_LC_Type1_doy2020001000000_aid0001) |&gt;\n  mutate(city = \"Clanton\")\n\nall_lulc &lt;- bind_rows(flagstaff_lulc, scranton_lulc, homerglen_lulc, belvidere_lulc, \n                      beecave_lulc, clanton_lulc)\nall_lulc$city &lt;- factor(all_lulc$city, levels = c(\"Flagstaff\", \"Scranton\",\n                                                     \"Homer Glen\", \"Belvidere\",\n                                                     \"Bee Cave\", \"Clanton\"))\n\n\nStatistical testing was done on the nonaggregated urban lights values. Although there are thousands of samples, radiance data exhibit a heavy right skew. The Shapiro-Wilk test was used to confirm non-normality, and since the data are not normal, a Wilcoxon test was used for each community pair to test if the Comparison group radiance is greater than that of the Dark Sky group.\n\n\nCode\n# Prep values for statistical testing\npair_a_uvals &lt;- bind_rows(urban_ntl_vals[[1]], urban_ntl_vals[[4]])\npair_b_uvals &lt;- bind_rows(urban_ntl_vals[[2]], urban_ntl_vals[[5]])\npair_c_uvals &lt;- bind_rows(urban_ntl_vals[[3]], urban_ntl_vals[[6]])\n\nfor (i in 1:length(urban_ntl_vals)) {\n  shapiro_test &lt;- shapiro.test(urban_ntl_vals[[i]]$value)\n  if (shapiro_test$p.value &lt; 0.05) {\n    print(\"Reject normality\")\n  } else {\n    print(\"Fail to reject normality\")\n  }\n}\n\nwilcox_a &lt;- wilcox.test(value ~ group, data = pair_a_uvals, alternative = \"greater\")\n\nwilcox_b &lt;- wilcox.test(value ~ group, data = pair_b_uvals, alternative = \"greater\")\n\nwilcox_c &lt;- wilcox.test(value ~ group, data = pair_c_uvals, alternative = \"greater\")\n\n# Repeat analysis for only 2021 - 2024 due to population trends\npair_a_recent &lt;- pair_a_uvals |&gt;\n  filter(name %in% c(\"t2021\", \"t2022\", \"t2023\", \"t2024\"))\npair_b_recent &lt;- pair_b_uvals |&gt;\n  filter(name %in% c(\"t2021\", \"t2022\", \"t2023\", \"t2024\"))\npair_c_recent &lt;- pair_c_uvals |&gt;\n  filter(name %in% c(\"t2021\", \"t2022\", \"t2023\", \"t2024\"))\n\nwilcox_a_recent &lt;- wilcox.test(value ~ group, data = pair_a_recent, alternative = \"greater\")\n\nwilcox_b_recent &lt;- wilcox.test(value ~ group, data = pair_b_recent, alternative = \"greater\")\n\nwilcox_c_recent &lt;- wilcox.test(value ~ group, data = pair_c_recent, alternative = \"greater\")"
  },
  {
    "objectID": "index.html#national-trends",
    "href": "index.html#national-trends",
    "title": "Starry Night?",
    "section": "National Trends",
    "text": "National Trends\nMean nighttime light radiance for the entire contiguous US is plotted below, where a generally increasing trend can be observed over the past ten years.\n\n\nCode\nggplot(conus_df) +\n  geom_point(aes(x = year, y = mean_ntl)) +\n  geom_smooth(aes(x = year, y = mean_ntl)) +\n  labs(x = \"Year\", y = expression(\"Mean Radiance (nW cm\"^-2~\"sr\"^-1*\")\"),\n       title = \"Annual US Mean Radiance (2014 - 2024)\") +\n  theme_light()\n\n\n\n\n\n\n\n\n\nState means for 2024 are shown in the figure below. Annual radiance tends to be higher for eastern states, which reflects known patterns of population density.\n\n\nCode\n# Create ggplot map for ggiraph\nst_2024_mean_map &lt;- ggplot() +\n  geom_sf_interactive(data = filter(states_ntl, NAME != \"District of Columbia\"), \n                      aes(fill = ntl_2024,\n                      tooltip = paste(NAME, \"\\n\", round(ntl_2024, 2)),\n                      data_id = NAME)) +\n  theme_void() +\n  theme(text = element_text(family = \"Arial\")) +\n  scale_fill_viridis_c() +\n  labs(title = \"Mean Nighttime Lights by State, 2024\", \n       fill = expression(\"Mean Radiance (nW cm\"^-2~\"sr\"^-1*\")\"),\n       caption = \"Data: NASA Black Marble & US Census Bureau\")\n\n# Transform into interactive ggiraph object\ngirafe(ggobj = st_2024_mean_map,\n       options = list(opts_hover(css = \"stroke:cyan;stroke-width:2px\"),\n                      opts_hover_inv(css = \"opacity:0.8;\"),\n                      opts_tooltip(css = \"background-color:white;color:black;padding:15px;\n                                          border-radius:10px;\n                                          font-family:Arial;font-size:15px;\"\n                                          )))\n\n\n\n\n\n\nIn the period from 2014 to 2024, most states experienced an increase in detected nighttime radiance. Texas, Montana, Idaho, and Utah all show particularly large increases upwards of 40%. More research is required to explain these trends, but possible drivers include recent population growth and urban development. On the other hand, several states have stayed fairly constant or even decreased over the 10-year span.\n\n\nCode\nst_pct_change_map &lt;- ggplot() + \n  geom_sf_interactive(data = filter(states_ntl, NAME != \"District of Columbia\"), \n                      aes(fill = pct_change,\n                          tooltip = paste(NAME, \"\\n\", round(pct_change, 1),\"%\", \n                                          \"\\n2014: \", round(ntl_2014, 2),\n                                          \"\\n2024: \", round(ntl_2024, 2)),\n                          data_id = NAME)) +\n  theme_void() +\n  theme(text = element_text(family = \"Arial\")) +\n  scale_fill_gradient2(low = \"navy\", \n                       mid = \"white\",\n                       high = \"darkred\",\n                      midpoint = 0) +\n  labs(title = \"Mean Radiance Percent Change (2014 - 2024)\",\n       fill = \"% Change\",\n       caption = \"Data: NASA Black Marble & US Census Bureau\")\n\ngirafe(ggobj = st_pct_change_map,\n       options = list(opts_hover(css = \"stroke:black;stroke-width:2px\"),\n                 opts_hover_inv(css = \"opacity:0.8;\"),\n                 opts_tooltip(css = \"background-color:white;color:black;padding:15px;\n                                     border-radius:10px;\n                                     font-family:Arial;font-size:15px;\")))"
  },
  {
    "objectID": "index.html#case-studies-1",
    "href": "index.html#case-studies-1",
    "title": "Starry Night?",
    "section": "Case Studies",
    "text": "Case Studies\n\n\nCode\n# Leaflet prep\nfs_coord &lt;- st_centroid(flagstaff_sf) |&gt;\n  st_coordinates() |&gt;\n  data.frame() |&gt;\n  mutate(city = \"Flagstaff\", pair = \"A\", group = \"Dark Sky\")\n\nsc_coord &lt;- st_centroid(scranton_sf) |&gt;\n  st_coordinates() |&gt;\n  data.frame() |&gt;\n  mutate(city = \"Scranton\", pair = \"A\", group = \"Comparison\")\n\nhg_coord &lt;- st_centroid(homerglen_sf) |&gt;\n  st_coordinates() |&gt;\n  data.frame() |&gt;\n  mutate(city = \"Homer Glen\", pair = \"B\", group = \"Dark Sky\")\n\nbv_coord &lt;- st_centroid(belvidere_sf) |&gt;\n  st_coordinates() |&gt;\n  data.frame() |&gt;\n  mutate(city = \"Belvidere\", pair = \"B\", group = \"Comparison\")\n\nbc_coord &lt;- st_centroid(beecave_sf) |&gt;\n  st_coordinates() |&gt;\n  data.frame() |&gt;\n  mutate(city = \"Bee Cave\", pair = \"C\", group = \"Dark Sky\")\n\ncl_coord &lt;- st_centroid(clanton_sf) |&gt;\n  st_coordinates() |&gt;\n  data.frame() |&gt;\n  mutate(city = \"Clanton\", pair = \"C\", group = \"Comparison\")\n\nmarkers_df &lt;- bind_rows(fs_coord, sc_coord, hg_coord, bv_coord, bc_coord, cl_coord)\nmarkers_df$pair &lt;- as.factor(markers_df$pair)\n\nlog_us_2024_ds &lt;- rast(\"data/log_us_2024_downsampled.tif\")\n\nvals &lt;- values(log_us_2024_ds, mat = FALSE)\nmidpoint &lt;- 3.5\n\nbreaks &lt;- c(min(vals, na.rm = TRUE),\n            seq(min(vals, na.rm = TRUE), midpoint, length.out = 5)[-1],\n            seq(midpoint, max(vals, na.rm = TRUE), length.out = 5)[-1])\n\npal &lt;- colorBin(palette = c(\"black\", \"yellow\", \"red\"),\n                domain = vals,\n                bins = breaks,\n                na.color = \"transparent\")\n\n\ncity_color_pal &lt;- colorFactor(palette = c(\"firebrick\", \"royalblue3\", \"green4\"),\n                           domain = markers_df$pair)\n\ncity_popup &lt;- paste0(\"&lt;b&gt;\", markers_df$city, \"&lt;/b&gt;&lt;br/&gt;\",\n                     \"&lt;i&gt;\", markers_df$group, \" Community&lt;/i&gt;&lt;br/&gt;\",\n                     \"Pair: \", markers_df$pair)\n\n# Leaflet map\nleaflet() |&gt;\n  addProviderTiles(\"CartoDB\") |&gt;\n  addRasterImage(log_us_2024_ds, group = \"US NTL\", colors = pal) |&gt;\n  addCircleMarkers(data = markers_df, ~X, ~Y, fillColor = ~city_color_pal(pair), \n                   fillOpacity = 0.9, color = \"black\", \n                   label = ~as.character(city), popup = city_popup)\n\n\n\n\n\n\nFrom the plot below, four of the six case study cities exhibit an increasing mean radiance trend similar to that of the national mean. However, the Pair A cities, Flagstaff and Scranton, show decreasing tendencies. The large difference in radiance values within pairs is another notable feature of this plot.\n\n\nCode\n# Prep data frame so that plots show in desired order\nall_ntl_means_df$pair &lt;- as.factor(all_ntl_means_df$pair)\npair_names &lt;- c(\"A\" = \"Flagstaff & Scranton\", \"B\" = \"Homer Glen & Belvidere\", \"C\" = \"Bee Cave & Clanton\")\n\n# Plot of annual means\nggplot(data = all_ntl_means_df) +\n  geom_line(aes(x = year, y = mean_ntl, color = pair, linetype = group), linewidth = 1) +\n  facet_wrap(~ pair, labeller = labeller(pair = pair_names)) +\n  scale_linetype_manual(values = c(\"Dark Sky\" = \"solid\", \"Comparison\" = \"dashed\")) +\n  scale_color_manual(values = c(\"A\" = \"firebrick\", \"B\" = \"royalblue3\", \"C\" = \"green4\")) +\n  labs(x = \"Year\",\n       y = expression(\"Mean Radiance (nW cm\"^-2~\"sr\"^-1*\")\"),\n       title = \"Mean Annual Radiance\",\n       linetype = \"City Type\",\n       color = \"Pair\") +\n  theme_light() +\n  theme(strip.text.x = element_text(color = \"black\"),\n        plot.title = element_text(hjust = 0.5),\n        aspect.ratio = 1.8)\n\n\n\n\n\n\n\n\n\nSimply looking at the annual means provides interesting information, but fails to take into account two factors that may influence a city’s observed nighttime light emissions: population over time and land cover. Annual population data reveals that Flagstaff and Bee Cave have both experienced steep population growth from 2014 to 2024. While Belvidere shows a generally decreasing trend, both Belvidere and Homer Glen had relatively stable populations with less than 5% change. Scranton and Clanton’s populations have also remained quite stable.\n\n\nCode\nggplot(data = all_ntl_means_df) +\n  geom_line(aes(x = year, y = pop_est, color = pair, linetype = group), linewidth = 1) +\n  facet_wrap(~ pair, labeller = labeller(pair = pair_names), scale = \"free_y\") +\n  scale_linetype_manual(values = c(\"Dark Sky\" = \"solid\", \"Comparison\" = \"dashed\")) +\n  scale_color_manual(values = c(\"A\" = \"firebrick\", \"B\" = \"royalblue3\", \"C\" = \"green4\")) +\n  labs(x = \"Year\",\n       y = \"Population\",\n       title = \"Annual Populations\",\n       linetype = \"City Type\",\n       color = \"Pair\") +\n  theme_light() +\n  theme(strip.text.x = element_text(color = \"black\"),\n        plot.title = element_text(hjust = 0.5),\n        axis.text.y = element_text(size = 8),\n        aspect.ratio = 1.8)\n\n\n\n\n\n\n\n\n\nLand cover differences between paired cities helps to explain some of the features and differences observed in the plot of mean nighttime lights versus time. Flagstaff contains much more undeveloped land like grassland and savannas, whereas most of Scranton is classified as urban and built up, which likely accounts for the much lower mean values for Flagstaff. Similarly, Clanton has a very small amount of land classified as urban & built-up, which probably contributes to a low mean radiance.\n\n\nCode\nggplot(all_lulc, aes(x = x, y = y)) +\n  geom_tile(aes(fill = landcover)) +\n  facet_wrap(~ city, nrow = 3, scales = \"free\") +\n  coord_quickmap() +\n  theme_light() +\n  theme(axis.title.x = element_blank(),\n        axis.text.x = element_blank(),\n        axis.title.y = element_blank(),\n        axis.text.y = element_blank(),\n        strip.text.x = element_text(color = \"black\")) +\n  labs(fill = \"Land Cover\",\n       caption = \"Data: NASA & US Census Bureau\") +\n  scale_fill_viridis_d()\n\n\n\n\n\n\n\n\n\nGiven the imbalances in land cover between different cities, it is useful for the sake of comparison to restrict analysis to urban areas. Proceeding this way introduces the assumption that any lighting policy effects outside of non-built-up areas are dwarfed by those on urban areas. From the plots of urban mean radiance, we can see that the radiance for the Dark Sky Places is generally lower than for their paired cities.\n\n\nCode\n# Urban mean NTL plot\nggplot(data = all_ntl_means_df) +\n  geom_line(aes(x = year, y = mean_urban_ntl, color = pair, linetype = group), linewidth = 1) +\n  facet_wrap(~ pair, labeller = labeller(pair = pair_names), scales = \"free_y\") +\n  scale_linetype_manual(values = c(\"Dark Sky\" = \"solid\", \"Comparison\" = \"dashed\")) +\n  scale_color_manual(values = c(\"A\" = \"firebrick\", \"B\" = \"royalblue3\", \"C\" = \"green4\")) +\n  labs(x = \"Year\",\n       y = expression(\"Mean Radiance (nW cm\"^-2~\"sr\"^-1*\")\"),\n       title = \"Mean Annual Radiance from Urban Areas\",\n       linetype = \"City Type\",\n       color = \"Pair\") +\n  theme_light() +\n  theme(strip.text.x = element_text(color = \"black\"),\n        plot.title = element_text(hjust = 0.5),\n        aspect.ratio = 1.8)\n\n\n\n\n\n\n\n\n\nThe results of the Wilcoxon test on the urban radiance values suggest that the observed differences between the Dark Sky communities and their Comparison counterparts are statistically significant. Given the population discrepancies between the Pair A and Pair C cities in the earlier analysis years, analysis was done on the entire set of data and on a subset of data from 2021-2024, when the populations became more comparable.\n\n\n\nPair\np-value (2014-2024)\np-value (2021-2024)\n\n\n\n\nA\n&lt;0.0001\n&lt;0.0001\n\n\nB\n&lt;0.0001\n&lt;0.0001\n\n\nC\n0.00591\n0.03937\n\n\n\n\nDiscussion of lighting policies\n\nPair A\nAs the home of two major observatories, Flagstaff has been at the forefront of outdoor lighting policy since 1958. The city’s lighting ordinance aims to encourage lighting practices and systems that will minimize light pollution and trespass while still maintaining nighttime safety, security, and productivity. The code includes comprehensive standards for maximum total outdoor light output, shielding requirements, time limits, sign illumination, and lamp types. [13]\nScranton’s Zoning Ordinance includes one short section devoted to lighting, which mainly focuses on curbing light trespass and nuisance glare. Maximum illumination levels are defined for two lighting levels. [14]\n\n\nPair B\nHomer Glen’s outdoor lighting ordinance is rooted in the desire to preserve rural character and aesthetic value. The ordinance establishes maximum light output and inclination for various outdoor lighting applications, permitted hours for lighting, shielding requirements, and bulb types. [15]\nSimilar to Scranton, Belvidere includes exterior lighting standards in their code of ordinances but does so for the purposes of promoting traffic safety and preventing nuisances. The ordinance sets limits on illumination intensity and hours of illumination outside of buildings, plus some requirements for light orientation and shielding. However, these provisions are not as strict or clearly defined as those in the Homer Glen ordinanace. [16]\n\n\nPair C\nBee Cave’s Unified Development Code contains a comprehensive lighting ordinance that appears similar to Flagstaff’s. The code addresses lighting controls, lumen caps, shielding and cut-off standards, sign illumination restrictions, and more. [17]\nThe code of ordinances for Clanton lacks a section devoted to lighting. Still, lights are mentioned in relation to other regulated items like signs and gas stations. The ordinance for gas stations includes a provision to prevent light trespass, but otherwise, outdoor lighting policy does not appear to be a priority for the city. [18]"
  },
  {
    "objectID": "index.html#footnotes",
    "href": "index.html#footnotes",
    "title": "Starry Night?",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nAlthough land cover changes over the period from 2014 to 2024, for the purposes of this project, only one year of land cover data was considered for each community. Data availability is one reason for this simplification – annual data is not available for all study areas for all years, and the MODIS science team urges caution when using land cover layers for 2021 and beyond due to lack of updates to the classification training database [11]. Therefore, 2019 data was used for all cities except for Clanton, which used 2020 data.↩︎"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "This site hosts the final project for GEO511 Spatial Data Science."
  }
]