[
  {
    "objectID": "data/Readme.html",
    "href": "data/Readme.html",
    "title": "Data Folder",
    "section": "",
    "text": "Data Folder\nPlace any data needed by your analysis in this folder. Please do not store large files here. Then read in any data using the ‘data’ path. For example, read_csv(\"data/data.csv\")."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Starry Night?",
    "section": "",
    "text": "Electric lights have benefited society immensely since their invention in 1879. Modern work, recreation, and transportation are made possible largely due to artificial lighting. However, when artificial outdoor lighting becomes inefficient and unnecessary, it is known as light pollution, with negative impacts on both wildlife and humans [1].\nConcerns about the impacts of light pollution on observational astronomy led to the 1988 formation of the nonprofit now known as DarkSky International [2]. Since then, DarkSky has grown into a recognized global authority on light pollution with a mission to safeguard communities and wildlife against light pollution [3]. The organization’s International Dark Sky Places program allows communities, parks, and protected areas to seek certification for efforts to preserve and protect their dark skies [4]. While many communities implement outdoor lighting policies without seeking recognition, a DarkSky certification is an indicator of places that have made dark sky conservation a priority.\nThis project aims to explore trends in nighttime light levels first from a national contiguous US perspective, and through more detailed case studies of individual cities. Three DarkSky certified communities [4] with different sizes and designation dates have been selected:\n\nFlagstaff, Arizona: Population ~77,000, designated 2001;\nHomer Glen, Illinois: Population ~25,000, designated 2011;\nBee Cave, Texas: Population ~9,000, designated 2023.\n\nThese three communities will each be paired with a community of similar size that has fewer, if any, ordinances controlling light pollution. Each community pair will be examined to see if there are observable differences in nighttime light emissions."
  },
  {
    "objectID": "index.html#download-and-clean-all-required-data",
    "href": "index.html#download-and-clean-all-required-data",
    "title": "Starry Night?",
    "section": "Download and clean all required data",
    "text": "Download and clean all required data\n\nNational and statewide nighttime lights\nA US Census TIGER shapefile was downloaded to provide geographic state boundaries. A separate script was used to download and save annual nighttime lights data for the contiguous US (‘black_marble_data_download.R’). Raster data was downloaded for plotting purposes, and extracted mean nighttime lights values were also downloaded for analysis. Nighttime lights are radiance values with units of \\(\\frac{n W}{cm^2 sr}\\).\n\n\nCode\n# Define national spatial extent\nnonconus &lt;- c(\"Guam\", \"Hawaii\", \"Alaska\",\n              \"Commonwealth of the Northern Mariana Islands\",\n              \"United States Virgin Islands\", \"American Samoa\", \"Puerto Rico\")\n\nstates_sf &lt;- states() |&gt;\n  filter(!NAME %in% nonconus) |&gt;\n  select(NAME, geometry) |&gt;\n  st_transform(crs = \"epsg:4326\")\n\n# Dissolve individual state boundaries to get CONUS outline\nconus &lt;- st_union(states_sf)|&gt;\n  st_as_sf()\n\n## Read in national raster data for 2024 (to be used for leaflet map later)\npb_download(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_t2024.tif\", \n            repo = \"cstaebell/final-project-cstaebell\")\n\nus_2024_rast &lt;- rast(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_t2024.tif\") |&gt;\n  mask(conus)\n\n# create log transformed version for plotting\nlog_us_2024 &lt;- app(us_2024_rast, fun = log1p)\n\n#---\n# Download and process annual US mean NTL data\n#---\nyears = 2014:2024\nconus_means = numeric(length(years))\n\nfor (i in 1:length(years)) {\n  pb_download(paste(\"CONUS_VNP46A4_NearNadir_Composite_Snow_Free_qflag_mean_t\",\n                             years[i], \".Rds\", sep = \"\"), repo = \"cstaebell/final-project-cstaebell\")\n  annual_mean &lt;- readRDS(paste(\"CONUS_VNP46A4_NearNadir_Composite_Snow_Free_qflag_mean_t\",\n                             years[i], \".Rds\", sep = \"\")) |&gt;\n    pull(ntl_mean)\n  \n  conus_means[i] &lt;- annual_mean\n}\n\nconus_df &lt;- data.frame(year = years, mean_ntl = conus_means)\n\n#---\n# Download and process mean NTL data for states\n#---\nstate_means &lt;- matrix(nrow = 49, ncol = length(years))\n\n# Read in annual data for states and create a matrix of state means\nfor (i in 1:length(years)) {\n  pb_download(paste(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_mean_t\",\n                             years[i], \".Rds\", sep = \"\"), repo = \"cstaebell/final-project-cstaebell\")\n  annual_mean &lt;- readRDS(paste(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_mean_t\",\n                             years[i], \".Rds\", sep = \"\"))\n  \n  state_means[,i] &lt;- annual_mean[,2]\n\n  # check that state names are ordered the same way for each year\n  if (i == 1) {\n    state_names &lt;- annual_mean[,1]\n  } else {\n    if (sum(state_names != annual_mean[,1]) != 0) {\n      print(\"Different state names\")\n    }\n  }\n}\n\n# Create data frame of state means and add percent change column\nstate_means_df &lt;- data.frame(state_means)\ncolnames(state_means_df) &lt;- paste(\"ntl_\", years, sep = \"\")\nstate_means_df &lt;- state_means_df |&gt;\n  mutate(state = state_names, \n         pct_change = (ntl_2024 - ntl_2014) / ntl_2014 * 100)\n\n\n# Combine state NTL data with geographic data\nstates_ntl &lt;- states_sf |&gt;\n  inner_join(state_means_df, by = c(\"NAME\" = \"state\"))\n\n\n\n\nCase Studies\nFor case study analyses, population data and local geographies for each Dark Sky Place were downloaded from the US Census.\n\n\nCode\n# Download population data\n# US population to search for companion cities\nus_pop &lt;- get_acs(geography = \"place\", state = NULL, \n                  variables = \"B01003_001\", key = census_api_key)\n\n# State populations for the states in which the selected DarksKy communities reside\naz_pop &lt;- get_acs(geography = \"place\", state = \"AZ\", \n                         variables = \"B01003_001\", key = census_api_key)\n\nil_pop &lt;- get_acs(geography = \"place\", state = \"IL\", \n                         variables = \"B01003_001\", key = census_api_key)\n\ntx_pop &lt;- get_acs(geography = \"place\", state = \"TX\", \n                         variables = \"B01003_001\", key = census_api_key)\n\n# Download local geographies: selected Dark Sky Places\nflagstaff &lt;- places(state = \"AZ\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Flagstaff\") |&gt;\n  st_transform(crs = \"epsg:4326\") |&gt;\n  left_join(us_pop, by = \"GEOID\")\n\nhomerglen &lt;- places(state = \"IL\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Homer Glen\") |&gt;\n  st_transform(crs = \"epsg:4326\") |&gt;\n  left_join(us_pop, by = \"GEOID\")\n\nbeecave &lt;- places(state = \"TX\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Bee Cave\") |&gt;\n  st_transform(crs = \"epsg:4326\") |&gt;\n  left_join(us_pop, by = \"GEOID\")\n\n\nCandidate cities to pair with each selected Dark Sky community were found by filtering US ACS population data to return a listing of municipalities with populations within 1% of each Dark Sky community population. Final comparison cities were selected based on population match and state. Preference was given to cities within states that are not known to have laws regarding light pollution or dark sky protection, as compiled by Schultz [12].\n\n\nCode\n# Get listing of suitable comparison cities\nflagstaff_sim_pop &lt;- us_pop |&gt; filter(estimate &gt;= (flagstaff$estimate - 0.005*flagstaff$estimate) \n                                & estimate &lt;= (flagstaff$estimate + 0.005*flagstaff$estimate)) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \")\n\nhomerglen_sim_pop &lt;- us_pop |&gt; filter(estimate &gt;= (homerglen$estimate - 0.005*homerglen$estimate) \n                                & estimate &lt;= (homerglen$estimate + 0.005*homerglen$estimate)) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \")\n\nbeecave_sim_pop &lt;- us_pop |&gt; filter(estimate &gt;= (beecave$estimate - 0.005*beecave$estimate) \n                                & estimate &lt;= (beecave$estimate + 0.005*beecave$estimate)) |&gt;\n  separate(NAME, into = c(\"city\", \"state\"), sep = \", \")\n\n# Download/process comparison city data\n # Flagstaff counterpart\nscranton &lt;- places(state = \"PA\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Scranton\") |&gt;\n  left_join(us_pop, by = \"GEOID\") |&gt;\n  st_transform(crs = \"epsg:4326\")\n\n # Homer Glen counterpart\nbelvidere &lt;- places(state = \"IL\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Belvidere\") |&gt;\n  left_join(us_pop, by = \"GEOID\") |&gt;\n  st_transform(crs = \"epsg:4326\")\n\n # Bee Cave counterpart\nclanton &lt;- places(state = \"AL\", cb = TRUE, year = 2024) |&gt;\n  filter(NAME == \"Clanton\") |&gt;\n  left_join(us_pop, by = \"GEOID\") |&gt;\n  st_transform(crs = \"epsg:4326\")\n\n\nThe final city pairs are as follows:\n\n\n\nPair\nCommunity\nPopulation\n\n\n\n\n1\nFlagstaff, AZ\n76,333\n\n\n1\nScranton, PA\n76,074\n\n\n2\nHomer Glen, IL\n24,516\n\n\n2\nBelvidere, IL\n24,510\n\n\n3\nBee Cave, TX\n8,861\n\n\n3\nClanton, AL\n8,862\n\n\n\nThe annual US nighttime lights rasters were then subsetted to create a raster and dataframe of mean values for each city.\n\n\nCode\n# Subset rasters to each area \ncities &lt;- list(flagstaff, homerglen, beecave, scranton, belvidere, clanton)\ncity_rasters &lt;- vector(\"list\", length = length(cities))\n\n# Load files for each year\nfor (i in 1:length(years)){\n  pb_download(paste(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_t\", \n                     years[i], \".tif\", sep = \"\"), repo = \"cstaebell/final-project-cstaebell\")\n  rast_file &lt;- paste(\"US_VNP46A4_NearNadir_Composite_Snow_Free_qflag_t\", \n                     years[i], \".tif\", sep = \"\")\n  \n  year_rast &lt;- rast(rast_file)\n  \n  # Loop over cities\n  for (j in 1:length(cities)) {\n    # Crop and mask to city extent\n    current_rast &lt;- year_rast |&gt;\n      terra::crop(cities[[j]]) |&gt;\n      mask(cities[[j]])\n    \n    # Create list entry during first iteration, then append in subsequent iterations\n    if (i == 1) {\n    city_rasters[[j]] &lt;- list(current_rast)\n    } else {\n    city_rasters[[j]][[length(city_rasters[[j]]) + 1]] &lt;- current_rast\n    }\n  }\n}\n\n# Stack city lists \ncity_rasters &lt;- lapply(city_rasters, rast)\n\n# Create separate rasters for each city \ncity_var_names &lt;- paste0(c(\"flagstaff\", \"homerglen\", \"beecave\", \"scranton\", \n                           \"belvidere\", \"clanton\"), \"_rast\")\nfor (c in 1:length(city_var_names)) {\n  assign(city_var_names[c], city_rasters[[c]])\n}\n\n\n# Calculate annual means\nannual_means &lt;- vector(\"list\", length = length(cities))\nfor (i in 1:length(city_rasters)) {\n  ntl_vals &lt;- data.frame(values(city_rasters[[i]])) |&gt;\n    summarize(across(t2014:t2024, ~ mean(.x, na.rm = TRUE)))\n  \n  annual_means[[i]] &lt;- ntl_vals\n}\n\n# Create mean dataframes for each city\ncity_df_var_names &lt;- paste0(c(\"flagstaff\", \"homerglen\", \"beecave\", \"scranton\", \n                           \"belvidere\", \"clanton\"), \"_means\")\nfor (i in 1:length(annual_means)) {\n  df &lt;- annual_means[[i]] |&gt;\n    pivot_longer(cols = t2014:t2024) |&gt;\n    mutate(name = years) |&gt;\n    rename(year = name, mean_ntl = value)\n  \n  assign(city_df_var_names[i], df)\n}\n\n\nHowever, simply looking at annual radiance means for each city may be more of a proxy for overall development or population density than for lighting policy. Land use/land cover data can be used to help make comparisons across communities more meaningful.\nAlthough land cover changes over the period from 2014 to 2024, for the purposes of this project, only one year of land cover data was considered for each community. Data availability is one reason for this simplification – annual data is not available for all study areas for all years, and the MODIS science team urges caution when using land cover layers for 2021 and beyond due to lack of updates to the classification training database [11]. Therefore, 2019 data was used for all cities except for Clanton, which used 2020 data.\nLand cover rasters were downloaded and cropped to each city. The urban areas in each city were identified, and then annual mean nighttime lights values were calculated for that urban area.\n\n\nCode\n# Download land cover data from GitHub Release\npb_download(\"MCD12Q1.061_LC_Type1_doy2019001000000_aid0001.tif\", \n            repo = \"cstaebell/final-project-cstaebell\")\npb_download(\"MCD12Q1.061_LC_Type1_doy2020001000000_aid0001.tif\", \n            repo = \"cstaebell/final-project-cstaebell\")\nland_use_rast_2019 &lt;- rast(\"MCD12Q1.061_LC_Type1_doy2019001000000_aid0001.tif\")\nland_use_rast_2020 &lt;- rast(\"MCD12Q1.061_LC_Type1_doy2020001000000_aid0001.tif\")\n\n# Subset land cover rasters to each city\ncity_ntl_rasters &lt;- list(flagstaff_rast, homerglen_rast, beecave_rast, scranton_rast, \n                           belvidere_rast, clanton_rast)\nland_use_rasters &lt;- vector(\"list\", length = length(cities))\nurban_ntl_dfs &lt;- vector(\"list\", length = length(cities))\n\nfor (i in 1:length(cities)) {\n  # Specify which data to use (2019 for all cities but Clanton)\n  if (i == 6) {\n    land_use_rast &lt;- land_use_rast_2020\n  } else {\n    land_use_rast &lt;- land_use_rast_2019\n  }\n  \n  # Crop and mask to city extent\n  current_rast &lt;- land_use_rast |&gt;\n    terra::crop(cities[[i]]) |&gt;\n    mask(cities[[i]])\n  # Save to list for future use \n  land_use_rasters[[i]] &lt;- current_rast\n  \n  # Mask all but urban land use (land use code = 13)\n  urban_area &lt;- current_rast\n  urban_area[urban_area != 13] &lt;- NA\n  city_urban &lt;- city_ntl_rasters[[i]] |&gt;\n    mask(urban_area) \n  \n  # Calculate mean NTL for urban areas \n  urban_ntl_dfs[[i]] &lt;- data.frame(values(city_urban)) |&gt;\n    summarize(across(t2014:t2024, ~ mean(.x, na.rm = TRUE))) |&gt;\n    pivot_longer(cols = t2014:t2024) |&gt;\n    mutate(name = years) |&gt;\n    rename(year = name, mean_urban_ntl = value)\n}\n\n# Create separate dataframes from list object\nurban_ntl_var_names &lt;- paste0(c(\"flagstaff\", \"homerglen\", \"beecave\", \"scranton\", \n                           \"belvidere\", \"clanton\"), \"_urban_ntl\")\n\nfor (i in 1:length(urban_ntl_dfs)) {\n  assign(urban_ntl_var_names[i], urban_ntl_dfs[[i]])\n}"
  },
  {
    "objectID": "index.html#national-trends",
    "href": "index.html#national-trends",
    "title": "Starry Night?",
    "section": "National Trends",
    "text": "National Trends\nThe 2024 nighttime lights across the contiguous US are visualized below.\n\n\nCode\nggplot() +\n  geom_spatraster(data = log_us_2024) + \n  scale_fill_gradient2(low = \"black\",\n                       mid = \"yellow\", \n                       high = \"red\",\n                       midpoint = 4.5,\n                       na.value = \"transparent\") +\n  labs(title = \"Nighttime Lights: 2024\") +\n  coord_sf() +\n  theme_void() +\n  theme(legend.position = \"none\")\n\n\n\n\n\n\n\n\n\nMean nighttime light radiance for the entire contiguous US is plotted below, where a generally increasing trend can be observed over the past ten years.\n\n\nCode\nggplot(conus_df) +\n  geom_point(aes(x = year, y = mean_ntl)) +\n  geom_smooth(aes(x = year, y = mean_ntl)) +\n  labs(x = \"Year\", y = expression(\"Mean Radiance (nW cm\"^-2~\"sr\"^-1*\")\"),\n       title = \"Annual US Mean Radiance (2014 - 2024)\") +\n  theme_light()\n\n\n\n\n\n\n\n\n\nState means for 2024 are plotted in the figure below. Annual radiance tends to be higher for eastern states, which reflects known patterns of population density.\n\n\nCode\n# Create ggplot map for ggiraph\nst_2024_mean_map &lt;- ggplot() +\n  geom_sf_interactive(data = filter(states_ntl, NAME != \"District of Columbia\"), \n                      aes(fill = ntl_2024,\n                      tooltip = paste(NAME, \"\\n\", round(ntl_2024, 2)),\n                      data_id = NAME)) +\n  theme_void() +\n  theme(legend.position = \"bottom\",\n        legend.direction = \"horizontal\") +\n  scale_fill_viridis_c() +\n  labs(title = \"Mean Annual Nighttime Lights by State, 2024\", \n       fill = expression(\"Mean Radiance (nW cm\"^-2~\"sr\"^-1*\")\"),\n       caption = \"Data: NASA Black Marble & US Census Bureau\")\n\n# Transform into interactive ggiraph object\nint_st2024mean &lt;- girafe(ggobj = st_2024_mean_map,\n                           options = list(opts_hover(css = \"stroke:cyan;stroke-width:2px\"),\n                                          opts_hover_inv(css = \"opacity:0.8;\"),\n                                          opts_tooltip(\n                                            css = \"background-color:white;color:black;padding:15px;\n                                            border-radius:10px;\n                                            font-family:Arial;font-size:15px;\"\n                                          )))\nint_st2024mean\n\n\n\n\n\n\nIn the period from 2014 to 2024, most states experienced an increase in detected nighttime radiance. Texas, Montana, Idaho, and Utah all show particularly large increases upwards of 40%. On the other hand, several states have stayed fairly constant or even decreased over the 10-year span.\n\n\nCode\nst_pct_change_map &lt;- ggplot() + \n  geom_sf_interactive(data = filter(states_ntl, NAME != \"District of Columbia\"), \n                      aes(fill = pct_change,\n                          tooltip = paste(NAME, \"\\n\", round(pct_change, 1),\"%\", \n                                          \"\\n2014: \", round(ntl_2014, 2),\n                                          \"\\n2024: \", round(ntl_2024, 2)),\n                          data_id = NAME)) +\n  theme_void() +\n  theme(legend.position = \"bottom\",\n        legend.direction = \"horizontal\") +\n  scale_fill_gradient2(low = \"navy\", \n                       mid = \"white\",\n                       high = \"darkred\",\n                      midpoint = 0) +\n  labs(title = \"Mean Radiance Percent Change (2014 - 2024)\",\n       fill = \"% Change\",\n       caption = \"Data: NASA Black Marble & US Census Bureau\")\n\ngirafe(ggobj = st_pct_change_map,\n       options = list(opts_hover(css = \"stroke:black;stroke-width:2px\"),\n                 opts_hover_inv(css = \"opacity:0.8;\"),\n                 opts_tooltip(css = \"background-color:white;color:black;padding:15px;\n                                     border-radius:10px;\n                                     font-family:Arial;font-size:15px;\")\n                 ))\n\n\n\n\n\n\nAnnual means line plots:\n\n\nCode\n# Annual means\nfs_means &lt;- ggplot() +\n  geom_line(data = flagstaff_means, aes(x = year, y = mean_ntl), color = \"blue\") +\n  geom_line(data = scranton_means, aes(x = year, y = mean_ntl), color = \"red\") +\n  labs(x = \"Year\", y = \"Mean NTL\", title = \"Flagstaff and Scranton Annual Mean Nighttime Lights\")\n\nhb_means &lt;- ggplot() +\n  geom_line(data = homerglen_means, aes(x = year, y = mean_ntl), color = \"blue\") +\n  geom_line(data = belvidere_means, aes(x = year, y = mean_ntl), color = \"red\") +\n  labs(x = \"Year\", y = \"Mean NTL\", title = \"Homer Glen and Belvidere Annual Mean Nighttime Lights\")\n\nbc_means &lt;- ggplot() +\n  geom_line(data = beecave_means, aes(x = year, y = mean_ntl), color = \"blue\") +\n  geom_line(data = clanton_means, aes(x = year, y = mean_ntl), color = \"red\") +\n  labs(x = \"Year\", y = \"Mean NTL\", title = \"Bee Cave and Clanton Annual Mean Nighttime Lights\")\n\nfs_means + hb_means + bc_means\n\n\n\n\n\n\n\n\n\nPlot mean urban NTL.\n\n\nCode\n# Compare cities\nfs_urban_means &lt;- ggplot() +\n  geom_line(data = flagstaff_urban_ntl, aes(x = year, y = mean_urban_ntl), color = \"blue\") +\n  geom_line(data = scranton_urban_ntl, aes(x = year, y = mean_urban_ntl), color = \"red\") +\n  labs(x = \"Year\", y = \"Mean NTL\", title = \"Flagstaff and Scranton Annual Mean Nighttime Lights\")\n\nhb_urban_means &lt;- ggplot() +\n  geom_line(data = homerglen_urban_ntl, aes(x = year, y = mean_urban_ntl), color = \"blue\") +\n  geom_line(data = belvidere_urban_ntl, aes(x = year, y = mean_urban_ntl), color = \"red\") +\n  labs(x = \"Year\", y = \"Mean NTL\", title = \"Homer Glen and Belvidere Annual Mean Nighttime Lights\")\n\nbc_urban_means &lt;- ggplot() +\n  geom_line(data = beecave_urban_ntl, aes(x = year, y = mean_urban_ntl), color = \"blue\") +\n  geom_line(data = clanton_urban_ntl, aes(x = year, y = mean_urban_ntl), color = \"red\") +\n  labs(x = \"Year\", y = \"Mean NTL\", title = \"Bee Cave and Clanton Annual Mean Nighttime Lights\")\n\nfs_urban_means + hb_urban_means + bc_urban_means\n\n\n\n\n\n\n\n\n\n\nSee if conclusions can be drawn after all cities are processed. This includes looking at the lighting policies in each city.\nInteractive graphics / graphics first with more details later?"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "This site hosts the final project for GEO511 Spatial Data Science."
  }
]